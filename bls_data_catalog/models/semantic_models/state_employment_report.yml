version: 2

# State Employment Report - Semantic Model
# Provides employment metrics by state and time period

semantic_models:
  - name: state_employment_report
    description: "Employment metrics by state and time period"
    model: ref('v_state_employment')
    config:
      meta:
        visualization_type: "table"
        component: "StateEmploymentTable"
        refresh_policy: "on_demand"

    defaults:
      agg_time_dimension: year_month

    # Primary entity (grain of the data)
    entities:
      - name: state
        type: primary
        expr: state_fips

      - name: region
        type: foreign
        expr: region_name

    # Dimensions (attributes for grouping/filtering)
    dimensions:
      - name: year_month
        type: time
        type_params:
          time_granularity: month

      - name: state_name
        type: categorical
        expr: state_name

      - name: state_abbr
        type: categorical
        expr: state_abbr

      - name: region_name
        type: categorical
        expr: region_name

      - name: division_name
        type: categorical
        expr: division_name

      - name: year_value
        type: categorical
        expr: year

      - name: quarter_value
        type: categorical
        expr: year_quarter

    # Measures (aggregatable fields)
    # Note: BLS LAUS data returns values in thousands
    measures:
      - name: total_employment
        description: "Total employment level (in thousands of persons)"
        agg: sum
        expr: employment_level

      - name: total_unemployed
        description: "Total unemployed persons (in thousands)"
        agg: sum
        expr: unemployed

      - name: total_labor_force
        description: "Total labor force (in thousands of persons)"
        agg: sum
        expr: labor_force

      - name: avg_unemployment_rate
        description: "Average unemployment rate (as percentage)"
        agg: average
        expr: unemployment_rate

      - name: state_count
        description: "Number of states"
        agg: count_distinct
        expr: state_fips

# Metrics derived from this semantic model
metrics:
  - name: total_employment
    description: "Total employment across selected dimensions (in thousands)"
    type: simple
    label: "Total Employment"
    type_params:
      measure: total_employment
    config:
      meta:
        format: "number"
        unit: "thousands"
        display_order: 1

  - name: total_unemployed
    description: "Total unemployed persons across selected dimensions (in thousands)"
    type: simple
    label: "Total Unemployed"
    type_params:
      measure: total_unemployed
    config:
      meta:
        format: "number"
        unit: "thousands"
        display_order: 2

  - name: total_labor_force
    description: "Total labor force across selected dimensions (in thousands)"
    type: simple
    label: "Total Labor Force"
    type_params:
      measure: total_labor_force
    config:
      meta:
        format: "number"
        unit: "thousands"
        display_order: 3

  - name: avg_unemployment_rate
    description: "Average unemployment rate across selected dimensions"
    type: simple
    label: "Average Unemployment Rate"
    type_params:
      measure: avg_unemployment_rate
    config:
      meta:
        format: "percentage"
        unit: "percent"
        display_order: 4

  - name: state_count
    description: "Number of distinct states in the selection"
    type: simple
    label: "State Count"
    type_params:
      measure: state_count
    config:
      meta:
        format: "number"
        unit: "states"
        display_order: 5
