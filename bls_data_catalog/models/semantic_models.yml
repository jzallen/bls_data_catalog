version: 2

# REPORTS LAYER - Semantic Models
# These define on-demand aggregations that can be queried via MetricFlow
# Each semantic model becomes a "Report" that can be rendered as a BI component

semantic_models:
  # Report 1: State Employment Overview
  # METADATA: {"visualization_type": "table", "component": "StateEmploymentTable", "refresh_policy": "on_demand"}
  - name: state_employment_report
    description: "Employment metrics by state and time period"
    model: ref('state_employment_combined')

    defaults:
      agg_time_dimension: year_month
    
    # Primary entity (grain of the data)
    entities:
      - name: state
        type: primary
        expr: state_fips
      
      - name: region
        type: foreign
        expr: region_name
    
    # Dimensions (attributes for grouping/filtering)
    dimensions:
      - name: year_month
        type: time
        type_params:
          time_granularity: month
      
      - name: state_name
        type: categorical
        expr: state_name
      
      - name: state_abbr
        type: categorical
        expr: state_abbr
      
      - name: region_name
        type: categorical
        expr: region_name
      
      - name: division_name
        type: categorical
        expr: division_name
      
      - name: year_value
        type: categorical
        expr: year

      - name: quarter_value
        type: categorical
        expr: year_quarter
    
    # Measures (metrics that can be aggregated)
    measures:
      - name: total_employment
        description: "Total employment level"
        agg: sum
        expr: employment_count
      
      - name: total_unemployed
        description: "Total unemployed persons"
        agg: sum
        expr: unemployed_count
      
      - name: total_labor_force
        description: "Total labor force"
        agg: sum
        expr: labor_force_count
      
      - name: avg_unemployment_rate
        description: "Average unemployment rate"
        agg: average
        expr: unemployment_rate
      
      - name: state_count
        description: "Number of states"
        agg: count_distinct
        expr: state_fips

  # Report 2: Regional Employment Trends
  # METADATA: {"visualization_type": "line_chart", "component": "RegionalTrendChart", "refresh_policy": "on_demand"}
  - name: regional_employment_report
    description: "Regional aggregated employment metrics over time"
    model: ref('state_employment_combined')

    defaults:
      agg_time_dimension: year_month
    
    entities:
      - name: region
        type: primary
        expr: region_name
    
    dimensions:
      - name: year_month
        type: time
        type_params:
          time_granularity: month
      
      - name: region_name
        type: categorical
        expr: region_name

      - name: year_value
        type: categorical
        expr: year
    
    measures:
      - name: regional_employment
        description: "Total regional employment"
        agg: sum
        expr: employment_count
      
      - name: regional_unemployment_rate
        description: "Regional weighted average unemployment rate"
        agg: average
        expr: unemployment_rate
      
      - name: regional_labor_force
        description: "Total regional labor force"
        agg: sum
        expr: labor_force_count

  # Report 3 & 4: Commented out to avoid duplicate entity+dimension pairing errors
  # These can be re-enabled once the semantic layer supports multiple models with same entity+dimension pairs
  # METADATA: {"visualization_type": "bar_chart", "component": "EmploymentGrowthChart", "refresh_policy": "on_demand"}
  # METADATA: {"visualization_type": "histogram", "component": "UnemploymentDistributionChart", "refresh_policy": "on_demand"}

# Metrics that can be derived from semantic models
metrics:
  # Metric 1: National Employment Total
  - name: national_employment
    description: "Total national employment across all states"
    type: simple
    label: "National Employment"
    type_params:
      measure: total_employment

  # Metric 2: Total Unemployed
  - name: national_unemployed
    description: "Total unemployed persons nationally"
    type: simple
    label: "Total Unemployed"
    type_params:
      measure: total_unemployed

  # Metric 3: Total Labor Force
  - name: national_labor_force
    description: "Total national labor force"
    type: simple
    label: "Total Labor Force"
    type_params:
      measure: total_labor_force
